
var grobjects = grobjects || [];

var Mountain = undefined;

(function() {
    "use strict";

    var shaderProgram = undefined;
    var buffers = undefined;
    var texture = null;

// constructor for a mountain
    // this is mostly a test to see how creating a model in Google Sketchup works for importing into the project.
    Mountain = function Mountain(name, position, size) {
        this.name = name;
        this.position = position || [0,0,0];
        this.size = size || 1.0;
        this.color = [0.647,0.265,0.265];
        this.texture = null;
    };
    Mountain.prototype.init = function(drawingState) {
        var gl=drawingState.gl;

        if (texture == null) {
            this.texture = new Texture("https://c1.staticflickr.com/1/743/31536690845_0254d188b1_o.png", gl, 0);
            texture = this.texture;
        }
        else {
            this.texture = texture;
        }
        if (!shaderProgram) {
            shaderProgram = twgl.createProgramInfo(gl, ["rock-vs", "rock-fs"]);
        }
        if (!buffers) {
            var arrays = {
                vpos : { numComponents: 3, data: [
                    133.70775787289,0,191.773992884484,0,0,-0,154.838246610138,162.358844650621,-63.753735315864,199.901211553712,208.084702695578,123.524573258169,133.70775787289,0,191.773992884484,154.838246610138,162.358844650621,-63.753735315864,381.915165677527,308.261976613249,-0,199.901211553712,208.084702695578,123.524573258169,154.838246610138,162.358844650621,-63.753735315864,381.915165677527,208.084702695578,-0,199.901211553712,208.084702695578,123.524573258169,381.915165677527,308.261976613249,-0,381.915165677527,208.084702695578,-0,133.70775787289,0,191.773992884484,199.901211553712,208.084702695578,123.524573258169,508.258728079251,-1.6029653594091e-29,234.7,133.70775787289,0,191.773992884484,381.915165677527,208.084702695578,-0,508.258728079251,371.126764914303,-0,381.915165677527,208.084702695578,-0,381.915165677527,308.261976613249,-0,508.258728079251,208.084702695578,40.8,381.915165677527,208.084702695578,-0,508.258728079251,371.126764914303,-0,508.258728079251,208.084702695578,40.8,508.258728079251,-1.6029653594091e-29,234.7,381.915165677527,208.084702695578,-0,818.085047442759,0,82.6,508.258728079251,-1.6029653594091e-29,234.7,508.258728079251,208.084702695578,40.8,508.258728079251,371.126764914303,-0,818.085047442759,324.156751980573,-16.8,570.09345710538,418.713912498144,-90.8533855538403,818.085047442759,324.156751980573,-16.8,508.258728079251,208.084702695578,40.8,508.258728079251,371.126764914303,-0,861.569799328577,208.084702695578,22.4,508.258728079251,208.084702695578,40.8,818.085047442759,324.156751980573,-16.8,508.258728079251,208.084702695578,40.8,861.569799328577,208.084702695578,22.4,818.085047442759,0,82.6,1053.99746008529,0,-0,818.085047442759,0,82.6,861.569799328577,208.084702695578,22.4,954.12518403038,264.761766516509,-90.8814319637561,861.569799328577,208.084702695578,22.4,818.085047442759,324.156751980573,-16.8,954.12518403038,264.761766516509,-90.8814319637561,1053.99746008529,0,-0,861.569799328577,208.084702695578,22.4,187.026619104226,0,-3.37310301241529,0,0,-0,133.70775787289,0,191.773992884484,
                    133.70775787289,0,191.773992884484,508.258728079251,-1.6029653594091e-29,234.7,552.087296888243,0,-0.917858862300611,1053.99746008529,0,-0,818.085047442759,0,-0.917858862300611,818.085047442759,0,82.6,818.085047442759,0,82.6,818.085047442759,0,-0.917858862300611,508.258728079251,-1.6029653594091e-29,234.7,187.026619104226,0,-3.37310301241529,133.70775787289,0,191.773992884484,552.087296888243,0,-0.917858862300611,508.258728079251,-1.6029653594091e-29,234.7,818.085047442759,0,-0.917858862300611,954.12518403038,0,-90.8814319637561,1053.99746008529,0,-0,954.12518403038,264.761766516509,-90.8814319637561,954.12518403038,0,-90.8814319637561,818.085047442759,148.326020622013,-90.8714967496364,570.09345710538,418.713912498144,-90.8533855538403,570.09345710538,0,-90.8533855538403,818.085047442759,148.326020622013,-90.8714967496364,508.258728079251,371.126764914303,-0,570.09345710538,418.713912498144,-90.8533855538403,818.085047442759,324.156751980573,-16.8,818.085047442759,148.326020622013,-90.8714967496364,570.09345710538,418.713912498144,-90.8533855538403,818.085047442759,148.326020622013,-90.8714967496364,818.085047442759,324.156751980573,-16.8,508.258728079251,371.126764914303,-0,818.085047442759,148.326020622013,-90.8714967496364,954.12518403038,264.761766516509,-90.8814319637561,818.085047442759,324.156751980573,-16.8,954.12518403038,264.761766516509,-90.8814319637561,818.085047442759,148.326020622013,-90.8714967496364,954.12518403038,0,-90.8814319637561,508.258728079251,371.126764914303,-0,570.09345710538,0,-90.8533855538403,570.09345710538,418.713912498144,-90.8533855538403,381.915165677527,308.261976613249,-0,570.09345710538,0,-90.8533855538403,508.258728079251,371.126764914303,-0,154.838246610138,162.358844650621,-63.753735315864,570.09345710538,0,-90.8533855538403,381.915165677527,308.261976613249,-0,0,0,-0,570.09345710538,0,-90.8533855538403,154.838246610138,162.358844650621,-63.753735315864,570.09345710538,0,-90.8533855538403,954.12518403038,0,-90.8814319637561
                ] },
                vnormal : {numComponents:3, data: [
                    0.578048474479971,-0.709529021719803,-0.403024228165898,0.578048474479971,-0.709529021719803,-0.403024228165898,0.578048474479971,-0.709529021719803,-0.403024228165898,0.929324249679393,-0.341611781284991,-0.140206383039889,0.929324249679393,-0.341611781284991,-0.140206383039889,0.929324249679393,-0.341611781284991,-0.140206383039889,0.52246267265452,-0.848756561325991,0.0815172085438102,0.52246267265452,-0.848756561325991,0.0815172085438102,0.52246267265452,-0.848756561325991,0.0815172085438102,-0.561548433636809,0,-0.827443869202042,-0.561548433636809,0,-0.827443869202042,-0.561548433636809,0,-0.827443869202042,-0.559148064887774,-0.0923625190871242,-0.823906916223027,-0.559148064887774,-0.0923625190871242,-0.823906916223027,-0.559148064887774,-0.0923625190871242,-0.823906916223027,0.0784686607311331,-0.724608899870958,-0.684678473088546,0.0784686607311331,-0.724608899870958,-0.684678473088546,0.0784686607311331,-0.724608899870958,-0.684678473088546,0,0,-1,0,0,-1,0,0,-1,0.298943715515596,-0.23165564432802,-0.925725832741369,0.298943715515596,-0.23165564432802,-0.925725832741369,0.298943715515596,-0.23165564432802,-0.925725832741369,0.229926047852006,-0.663466171597444,-0.712001862121854,0.229926047852006,-0.663466171597444,-0.712001862121854,0.229926047852006,-0.663466171597444,-0.712001862121854,-0.338018385954242,-0.641604013733967,-0.688540383940805,-0.338018385954242,-0.641604013733967,-0.688540383940805,-0.338018385954242,-0.641604013733967,-0.688540383940805,0.154747850982158,0.827971420461101,0.538995760202277,0.154747850982158,0.827971420461101,0.538995760202277,0.154747850982158,0.827971420461101,0.538995760202277,-0.0890489468511871,-0.24179231714043,-0.966233284686755,-0.0890489468511871,-0.24179231714043,-0.966233284686755,-0.0890489468511871,-0.24179231714043,-0.966233284686755,-0.0489844873416245,-0.336006864811395,-0.940584874851544,-0.0489844873416245,-0.336006864811395,-0.940584874851544,-0.0489844873416245,-0.336006864811395,-0.940584874851544,-0.0501074442536194,-0.267883086246024,-0.962147543848487,
                    -0.0501074442536194,-0.267883086246024,-0.962147543848487,-0.0501074442536194,-0.267883086246024,-0.962147543848487,-0.323791301707918,-0.199877500686175,-0.92477466317895,-0.323791301707918,-0.199877500686175,-0.92477466317895,-0.323791301707918,-0.199877500686175,-0.92477466317895,-0.57037447452657,-0.446514087055876,-0.689418689091902,-0.57037447452657,-0.446514087055876,-0.689418689091902,-0.57037447452657,-0.446514087055876,-0.689418689091902,-0.567499674918132,-0.450616012118056,-0.689122143448195,-0.567499674918132,-0.450616012118056,-0.689122143448195,-0.567499674918132,-0.450616012118056,-0.689122143448195,0,1,-0,0,1,-0,0,1,-0,3.42694485035226e-32,1,7.44070698228339e-32,3.42694485035226e-32,1,7.44070698228339e-32,3.42694485035226e-32,1,7.44070698228339e-32,0,1,-0,0,1,-0,0,1,-0,-5.17375464648113e-32,1,-6.8506435330082e-47,-5.17375464648113e-32,1,-6.8506435330082e-47,-5.17375464648113e-32,1,-6.8506435330082e-47,1.01414261338359e-32,1,5.03717244053534e-32,1.01414261338359e-32,1,5.03717244053534e-32,1.01414261338359e-32,1,5.03717244053534e-32,1.01414261338359e-32,1,5.03717244053534e-32,1.01414261338359e-32,1,5.03717244053534e-32,-0.673031363794071,0,0.739613942100534,-0.673031363794071,0,0.739613942100534,-0.673031363794071,0,0.739613942100534,7.30314916050314e-05,-8.78450503310973e-21,0.999999997333201,7.30314916050314e-05,-8.78450503310973e-21,0.999999997333201,7.30314916050314e-05,-8.78450503310973e-21,0.999999997333201,7.30314916050314e-05,-8.78450503310973e-21,0.999999997333201,-0.559991721936155,-0.51356391075739,-0.650124127325356,-0.559991721936155,-0.51356391075739,-0.650124127325356,-0.559991721936155,-0.51356391075739,-0.650124127325356,0.389749753177264,0.357523523763166,-0.848688435089244,0.389749753177264,0.357523523763166,-0.848688435089244,0.389749753177264,0.357523523763166,-0.848688435089244,-0.00888395449492285,-0.388208641462562,0.921528689757581,-0.00888395449492285,-0.388208641462562,0.921528689757581,-0.00888395449492285,-0.388208641462562,0.921528689757581,0.31538380935562,-0.36841064148803,0.874532247567073,
                    0.31538380935562,-0.36841064148803,0.874532247567073,0.31538380935562,-0.36841064148803,0.874532247567073,7.30314916050512e-05,-3.76152848154883e-21,0.999999997333201,7.30314916050512e-05,-3.76152848154883e-21,0.999999997333201,7.30314916050512e-05,-3.76152848154883e-21,0.999999997333201,0.826696150334813,8.30414962965259e-18,0.562648624828677,0.826696150334813,8.30414962965259e-18,0.562648624828677,0.826696150334813,8.30414962965259e-18,0.562648624828677,0.109059345296643,-0.219183847911669,0.969569234257204,0.109059345296643,-0.219183847911669,0.969569234257204,0.109059345296643,-0.219183847911669,0.969569234257204,-0.0621250334811299,-0.316864621619072,0.946433987017146,-0.0621250334811299,-0.316864621619072,0.946433987017146,-0.0621250334811299,-0.316864621619072,0.946433987017146,0.153114050778849,0.231246060593448,0.960771225065626,0.153114050778849,0.231246060593448,0.960771225065626,0.153114050778849,0.231246060593448,0.960771225065626,0,1,-0,0,1,-0
                ]}
            };
            buffers = twgl.createBufferInfoFromArrays(drawingState.gl,arrays);
        }
        if (!buffers) {
            buffers = twgl.createBufferInfoFromArrays(drawingState.gl,arrays);
            shaderProgram.program.tex = gl.getUniformLocation(shaderProgram.program, "tex");
            shaderProgram.program.normalMap = gl.getUniformLocation(shaderProgram.program, "normalMap");
            gl.useProgram(shaderProgram.program);
            gl.uniform1i(shaderProgram.program.tex, 0);
            initTextureThenDraw(this.texture);
            gl.uniform1i(shaderProgram.program.normalMap, 1);
            initTextureThenDraw(this.normalMap);
            //finishTextureInit(gl);
        }
    };
    Mountain.prototype.draw = function(drawingState) {
        // we make a model matrix to place the cube in the world
        var modelM = twgl.m4.scaling([this.size,this.size,this.size]);
        twgl.m4.setTranslation(modelM,this.position,modelM);
        // the drawing coce is straightforward - since twgl deals with the GL stuff for us
        var gl = drawingState.gl;
        gl.useProgram(shaderProgram.program);
        twgl.setBuffersAndAttributes(gl,shaderProgram,buffers);
        console.log();
        twgl.setUniforms(shaderProgram,{
            view:drawingState.view, proj:drawingState.proj, lightdir:drawingState.sunDirection,
            model: modelM, normalM: twgl.m4.transpose(twgl.m4.inverse(modelM)), spotlightPos:drawingState.spotlightPos});
        gl.activeTexture(gl.TEXTURE0);
        this.texture.bindTexture();
        //gl.activeTexture(gl.TEXTURE1);
        //this.normalMap.bindTexture();
        twgl.drawBufferInfo(gl, gl.TRIANGLES, buffers);
    };
    Mountain.prototype.center = function(drawingState) {
        return this.position;
    };
})();
// add a mountain
grobjects.push(new Mountain("mountain1",[-5,0,-5],0.01));
grobjects.push(new Mountain("mountain1",[-8,0,-6],0.01));